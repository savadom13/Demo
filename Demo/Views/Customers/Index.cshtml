@model IEnumerable<Demo.Models.Customer>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Index</h2>

<p>
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modCreateCustomer">
        Create
    </button>
</p>



<div id="modDetailDialog" class="modal fade">
    <div id="contentDetailDialog" class="modal-dialog"></div>
</div>


<div id="modCreateCustomer" class="modal fade">
    <div class="modal-body" id="form-container">
        @Html.Action("Create", "Customers")
    </div>
</div>


<table id="customers" class="table table-bordered table-hover">
    <thead>
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.FirstName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.LastName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.PhoneNumber)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Email)
        </th>
        <th></th>
    </tr>
    </thead>

    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.FirstName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.LastName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.PhoneNumber)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Email)
                </td>
                <td>
                    @Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
                    @Html.ActionLink("Details", "Details", new { id = item.Id }, new { @class = "itemDetailDialog" }) |
                    @Html.ActionLink("Delete", "Delete", new { id = item.Id })
                </td>
            </tr>
        }
    </tbody>
</table>

@section scripts
{
    <script>
        $(document).ready(function () {
            $("#customers").DataTable();

            $("#modCreateCustomer").on("submit", "#form-createCustomer", function (e) {
                e.preventDefault();  // prevent standard form submission

                var form = $(this);
                $.ajax({
                    //type: "POST",
                    url: form.attr('action'),
                    type: form.attr('method'),  // post
                    data: form.serialize(),
                    success: function (partialResult) {
                        $("#form-container").html(partialResult);
                    }
                });
            });

            $(function() {
                $.ajaxSetup({ cache: false });
                $(".itemDetailDialog").click(function (e) {

                    e.preventDefault();
                    $.get(this.href, function(data) {
                        $('#contentDetailDialog').html(data);
                        $('#modDetailDialog').modal('show');
                    });
                });
            });

        });
</script>
}